<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>UNIR Cinema - Selección</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="header">
  <h1>UNIR CINEMA</h1>
  <h2>Frontend Wars: la película</h2>
  <h3>Sala 1 - Selecciona tus asientos</h3>
</header>

<main>
  <section class="cinema">
    <div class="screen">PANTALLA</div>
    <div id="asiento-map" class="asiento-map" role="grid" aria-label="Mapa de asientos generados por algoritmo"></div>

    <div class="legend">
      <div><span class="asiento"></span> Disponible</div>
      <div><span class="asiento selected"></span> Seleccionada</div>
      <div><span class="asiento blocked"></span> No disponible</div>
    </div>

    <form id="asiento-form" class="asiento-form">
      <label for="numasientos">Número de asientos:</label>
      <input type="number" id="numasientos" min="1" max="10" required />
      <button type="submit">Reservar</button>
    </form>
  </section>
</main>

<footer>
  <div class="footer-container">
    <p><strong>© 2025 UNIR Cinema</strong></p>
    <p>Calle del Conocimiento 42, Logroño</p>
  </div>
</footer>

<script>
const N = 10;

function setup() {
  let id = 1;
  let butacas = [];
  for (let i = 0; i < N; i++) {
    let fila = [];
    for (let j = 0; j < N; j++) {
      fila.push({ id: id++, estado: Math.random() < 0.25 }); //Ponemos algunas butacas como no disponibles para facilitar pruebas
    }
    butacas.push(fila);
  }
  return butacas;
}

let butacas = setup();

function suggest(butacas, cantidad) {
  const filas = butacas.length;
  const columnas = butacas[0].length;
  let butacasresultado = new Set();

  if (cantidad > columnas) return butacasresultado;

  let i = filas - 1;
  while (i >= 0 && butacasresultado.size == 0) {
    let fila = butacas[i];
    let libres = 0;
    let inicio = 0;

    let j = 0;
    while (j < columnas && butacasresultado.size == 0) {
      if (!fila[j].estado) {
        libres++;
        if (libres === cantidad) {
          for (let k = inicio; k < inicio + cantidad; k++) {
            butacasresultado.add(fila[k].id);
          }
        }
      } else {
        libres = 0;
        inicio = j + 1;
      }

      j++;
    }

    i--;
  }

  return butacasresultado;
}


function pintaSala() {
  const map = document.getElementById("asiento-map");
  map.innerHTML = "";

  for (let i = 0; i < N; i++) {
    const filaDiv = document.createElement("div");
    filaDiv.className = "fila";
    for (let j = 0; j < N; j++) {
      const a = document.createElement("a");
      a.href = "#";
      a.className = "asiento";
      if (butacas[i][j].estado) a.classList.add("blocked");
      a.dataset.id = butacas[i][j].id;
      filaDiv.appendChild(a);
    }
    map.appendChild(filaDiv);
  }
}

pintaSala();

const form = document.getElementById("asiento-form");
form.addEventListener("submit", e => {
  e.preventDefault();
  const n = parseInt(document.getElementById("numasientos").value);
  const res = suggest (butacas, n);

  document.querySelectorAll('.asiento').forEach(a => a.classList.remove('selected'));

  if (res.size === 0) return;

  document.querySelectorAll('.asiento').forEach(a => {
    if (res.has(parseInt(a.dataset.id))) a.classList.add('selected');
  });
});
</script>
</body>
</html>
